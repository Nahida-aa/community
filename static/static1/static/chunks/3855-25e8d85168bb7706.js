"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3855],{98659:function(e,t,n){n.d(t,{i:function(){return r}});let r=["says"]},9607:function(e,t,n){n.r(t),n.d(t,{ClientOnly:function(){return c}});var r=n(71590),i=n(13373);let c=e=>(0,i.O)()?(0,r.jsx)(r.Fragment,{children:e.children}):null},74352:function(e,t,n){n.r(t),n.d(t,{HydrationEndDetector:function(){return a},isHydrationEnded:function(){return s}});var r=n(63488),i=n(36183),c=n(86990);let o=(0,i.atom)(!1),a=()=>((0,r.useEffect)(()=>{setTimeout(()=>{c.e.set(o,!0)},2e3)},[]),null),s=()=>c.e.get(o)},42769:function(e,t,n){n.d(t,{F:function(){return i}});var r=n(63488);let i=e=>{let{contexts:t,children:n}=e;return t.reduceRight((e,t)=>r.cloneElement(t,{children:e}),n)}},75832:function(e,t,n){n.d(t,{$F:function(){return h},Dj:function(){return v},EH:function(){return s},RM:function(){return d},WO:function(){return u},ak:function(){return C},iz:function(){return c},j6:function(){return i},kx:function(){return l},ol:function(){return a},pY:function(){return o},rM:function(){return E}});var r=n(71590);function i(e){return(0,r.jsx)("svg",{width:"1em",height:"1em",viewBox:"0 0 512 512",...e,children:(0,r.jsx)("path",{fill:"currentColor",d:"M288 39.056v16.659c0 10.804 7.281 20.159 17.686 23.066C383.204 100.434 440 171.518 440 256c0 101.689-82.295 184-184 184c-101.689 0-184-82.295-184-184c0-84.47 56.786-155.564 134.312-177.219C216.719 75.874 224 66.517 224 55.712V39.064c0-15.709-14.834-27.153-30.046-23.234C86.603 43.482 7.394 141.206 8.003 257.332c.72 137.052 111.477 246.956 248.531 246.667C393.255 503.711 504 392.788 504 256c0-115.633-79.14-212.779-186.211-240.236C302.678 11.889 288 23.456 288 39.056z"})})}function c(e){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",...e,children:(0,r.jsx)("path",{fill:"currentColor",d:"M1 11h3v2H1v-2m3.9-7.5L3.5 4.9L5.6 7L7 5.6L4.9 3.5M13 1h-2v3h2V1m7 10v2h3v-2h-3M10 22c0 .6.4 1 1 1h2c.6 0 1-.4 1-1v-1h-4v1m9.1-18.5L17 5.6L18.4 7l2.1-2.1l-1.4-1.4M18 12c0 2.2-1.2 4.2-3 5.2V19c0 .6-.4 1-1 1h-4c-.6 0-1-.4-1-1v-1.8c-1.8-1-3-3-3-5.2c0-3.3 2.7-6 6-6s6 2.7 6 6m-2 0c0-2.21-1.79-4-4-4s-4 1.79-4 4s1.79 4 4 4s4-1.79 4-4Z"})})}function o(e){return(0,r.jsx)("svg",{width:"1.13em",height:"1em",viewBox:"0 0 576 512",...e,children:(0,r.jsx)("path",{fill:"currentColor",d:"M416 192c0-88.4-93.1-160-208-160S0 103.6 0 192c0 34.3 14.1 65.9 38 92c-13.4 30.2-35.5 54.2-35.8 54.5c-2.2 2.3-2.8 5.7-1.5 8.7S4.8 352 8 352c36.6 0 66.9-12.3 88.7-25c32.2 15.7 70.3 25 111.3 25c114.9 0 208-71.6 208-160zm122 220c23.9-26 38-57.7 38-92c0-66.9-53.5-124.2-129.3-148.1c.9 6.6 1.3 13.3 1.3 20.1c0 105.9-107.7 192-240 192c-10.8 0-21.3-.8-31.7-1.9C207.8 439.6 281.8 480 368 480c41 0 79.1-9.2 111.3-25c21.8 12.7 52.1 25 88.7 25c3.2 0 6.1-1.9 7.3-4.8c1.3-2.9.7-6.3-1.5-8.7c-.3-.3-22.4-24.2-35.8-54.5z"})})}function a(e){return(0,r.jsx)("svg",{width:"1em",height:"1em",viewBox:"0 0 512 512",...e,children:(0,r.jsx)("path",{fill:"currentColor",d:"M512 0C460.22 3.56 96.44 38.2 71.01 287.61c-3.09 26.66-4.84 53.44-5.99 80.24l178.87-178.69c6.25-6.25 16.4-6.25 22.65 0s6.25 16.38 0 22.63L7.04 471.03c-9.38 9.37-9.38 24.57 0 33.94c9.38 9.37 24.59 9.37 33.98 0l57.13-57.07c42.09-.14 84.15-2.53 125.96-7.36c53.48-5.44 97.02-26.47 132.58-56.54H255.74l146.79-48.88c11.25-14.89 21.37-30.71 30.45-47.12h-81.14l106.54-53.21C500.29 132.86 510.19 26.26 512 0z"})})}function s(e){return(0,r.jsx)("svg",{width:"1em",height:"1em",viewBox:"0 0 512 512",...e,children:(0,r.jsx)("path",{fill:"currentColor",d:"M504 255.531c.253 136.64-111.18 248.372-247.82 248.468c-59.015.042-113.223-20.53-155.822-54.911c-11.077-8.94-11.905-25.541-1.839-35.607l11.267-11.267c8.609-8.609 22.353-9.551 31.891-1.984C173.062 425.135 212.781 440 256 440c101.705 0 184-82.311 184-184c0-101.705-82.311-184-184-184c-48.814 0-93.149 18.969-126.068 49.932l50.754 50.754c10.08 10.08 2.941 27.314-11.313 27.314H24c-8.837 0-16-7.163-16-16V38.627c0-14.254 17.234-21.393 27.314-11.314l49.372 49.372C129.209 34.136 189.552 8 256 8c136.81 0 247.747 110.78 248 247.531zm-180.912 78.784l9.823-12.63c8.138-10.463 6.253-25.542-4.21-33.679L288 256.349V152c0-13.255-10.745-24-24-24h-16c-13.255 0-24 10.745-24 24v135.651l65.409 50.874c10.463 8.137 25.541 6.253 33.679-4.21z"})})}function u(e){return(0,r.jsx)("svg",{width:"1.25em",height:"1em",viewBox:"0 0 640 512",...e,children:(0,r.jsx)("path",{fill:"currentColor",d:"M192 256c61.9 0 112-50.1 112-112S253.9 32 192 32S80 82.1 80 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C51.6 288 0 339.6 0 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zM480 256c53 0 96-43 96-96s-43-96-96-96s-96 43-96 96s43 96 96 96zm48 32h-3.8c-13.9 4.8-28.6 8-44.2 8s-30.3-3.2-44.2-8H432c-20.4 0-39.2 5.9-55.7 15.4c24.4 26.3 39.7 61.2 39.7 99.8v38.4c0 2.2-.5 4.3-.6 6.4H592c26.5 0 48-21.5 48-48c0-61.9-50.1-112-112-112z"})})}function l(e){return(0,r.jsx)("svg",{width:"1em",height:"1em",viewBox:"0 0 512 512",...e,children:(0,r.jsx)("path",{fill:"currentColor",d:"M256 8C119 8 8 119 8 256s111 248 248 248s248-111 248-248S393 8 256 8z"})})}function d(e){return(0,r.jsx)("svg",{width:"1em",height:"1em",viewBox:"0 0 512 512",...e,children:(0,r.jsx)("path",{fill:"currentColor",d:"M256 56c110.532 0 200 89.451 200 200 0 110.532-89.451 200-200 200-110.532 0-200-89.451-200-200 0-110.532 89.451-200 200-200m0-48C119.033 8 8 119.033 8 256s111.033 248 248 248 248-111.033 248-248S392.967 8 256 8zm0 168c-44.183 0-80 35.817-80 80s35.817 80 80 80 80-35.817 80-80-35.817-80-80-80z"})})}function E(e){return(0,r.jsx)("svg",{width:"1em",height:"1em",viewBox:"0 0 22 22",...e,children:(0,r.jsx)("path",{fill:"currentColor",d:"M6 22a3 3 0 0 1-3-3c0-.6.18-1.16.5-1.63L9 7.81V6a1 1 0 0 1-1-1V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v1a1 1 0 0 1-1 1v1.81l5.5 9.56c.32.47.5 1.03.5 1.63a3 3 0 0 1-3 3H6m-1-3a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1c0-.21-.07-.41-.18-.57l-2.29-3.96L14 17l-5.07-5.07l-3.75 6.5c-.11.16-.18.36-.18.57m8-9a1 1 0 0 0-1 1a1 1 0 0 0 1 1a1 1 0 0 0 1-1a1 1 0 0 0-1-1Z"})})}function h(e){return(0,r.jsxs)("svg",{width:"1em",height:"1em",viewBox:"0 0 22 22",...e,children:[(0,r.jsx)("path",{fill:"currentColor",d:"M6 6h11.17l1 1l-1 1H6V6zm12 10H6.83l-1-1l1-1H18v2z",opacity:".3"}),(0,r.jsx)("path",{fill:"currentColor",d:"M13 10h5l3-3l-3-3h-5V2h-2v2H4v6h7v2H6l-3 3l3 3h5v4h2v-4h7v-6h-7v-2zM6 6h11.17l1 1l-1 1H6V6zm12 10H6.83l-1-1l1-1H18v2z"})]})}function v(e){return(0,r.jsx)("svg",{width:"1em",height:"1em",viewBox:"0 0 512 512",...e,children:(0,r.jsx)("path",{fill:"currentColor",d:"M202.24 74C166.11 56.75 115.61 48.3 48 48a31.36 31.36 0 0 0-17.92 5.33A32 32 0 0 0 16 79.9V366c0 19.34 13.76 33.93 32 33.93c71.07 0 142.36 6.64 185.06 47a4.11 4.11 0 0 0 6.94-3V106.82a15.89 15.89 0 0 0-5.46-12A143 143 0 0 0 202.24 74Zm279.68-20.7A31.33 31.33 0 0 0 464 48c-67.61.3-118.11 8.71-154.24 26a143.31 143.31 0 0 0-32.31 20.78a15.93 15.93 0 0 0-5.45 12v337.13a3.93 3.93 0 0 0 6.68 2.81c25.67-25.5 70.72-46.82 185.36-46.81a32 32 0 0 0 32-32v-288a32 32 0 0 0-14.12-26.61Z"})})}function C(e){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"1em",height:"1em",fill:"currentColor",...e,children:(0,r.jsx)("path",{d:"M3.91762 8.0366C3.32984 9.23328 3 10.5792 3 11.9999C3 16.9704 7.02944 20.9999 12 20.9999C13.4216 20.9999 14.7684 20.6696 15.9657 20.081C16.8385 20.4544 17.6848 20.6991 18.4564 20.762C19.3582 20.8356 20.3 20.6665 20.9818 19.9847C21.7339 19.2325 21.8625 18.1689 21.7279 17.1727C21.6052 16.2638 21.2481 15.2537 20.726 14.2114C20.9051 13.503 21 12.7619 21 11.9999C21 7.02929 16.9706 2.99986 12 2.99986C11.2389 2.99986 10.4987 3.09454 9.79103 3.27318C8.7474 2.7498 7.73605 2.39172 6.8261 2.26834C5.82897 2.13315 4.76406 2.26128 4.01121 3.01413C3.3287 3.69664 3.16001 4.63956 3.2341 5.54233C3.29752 6.315 3.54313 7.16247 3.91762 8.0366ZM5.3224 5.96574C5.2734 5.75321 5.24204 5.55715 5.2274 5.37873C5.17928 4.79243 5.31727 4.53649 5.42543 4.42834C5.54452 4.30925 5.84797 4.15403 6.55739 4.25021C6.75482 4.27698 6.96951 4.32189 7.2 4.38547C6.50364 4.82527 5.87203 5.35784 5.3224 5.96574ZM19.6124 16.803C19.6751 17.0316 19.7195 17.2445 19.7459 17.4404C19.8416 18.1485 19.6865 18.4515 19.5676 18.5705C19.4595 18.6785 19.204 18.8163 18.6189 18.7686C18.4419 18.7542 18.2475 18.7233 18.0368 18.675C18.6427 18.1268 19.1736 17.4971 19.6124 16.803ZM15.8812 17.8264C14.2046 16.9482 12.2571 15.5026 10.3752 13.6207C8.4954 11.741 7.05092 9.79561 6.17241 8.12028C7.06357 6.78465 8.40124 5.77312 9.96933 5.29866C10.6108 5.10457 11.2923 4.99986 12 4.99986C15.866 4.99986 19 8.13386 19 11.9999C19 12.7083 18.8951 13.3904 18.7006 14.0325C18.2261 15.5991 17.2155 16.9356 15.8812 17.8264ZM13.6052 18.8152C13.0901 18.9359 12.5528 18.9999 12 18.9999C8.13401 18.9999 5 15.8658 5 11.9999C5 11.4476 5.06377 10.9109 5.18429 10.3963C6.14883 11.913 7.43475 13.5087 8.96096 15.0349C10.489 16.563 12.0868 17.8502 13.6052 18.8152Z"})})}n(63488)},70494:function(e,t,n){n.d(t,{S:function(){return c}});var r=n(71590),i=n(84372);let c=e=>(0,r.jsx)(i.q,{className:"!fixed",children:(0,r.jsx)("span",{children:e.loadingText})})},84372:function(e,t,n){n.d(t,{q:function(){return a},$:function(){return o}});var r=n(71590),i=n(63488),c=n(31721);let o=(0,i.forwardRef)((e,t)=>{let{className:n,size:i}=e;return(0,r.jsx)("div",{className:n,ref:t,children:(0,r.jsx)("div",{className:"loading loading-dots",style:{width:i||"2rem",height:i||"2rem"}})})});o.displayName="Spinner";let a=e=>{let{children:t,className:n}=e;return(0,r.jsxs)("div",{className:(0,c.Z)("inset-0 z-10 flex flex-col items-center justify-center gap-6",n),children:[(0,r.jsx)(o,{}),t]})}},25112:function(e,t,n){var r;n.d(t,{y:function(){return r}}),(r||(r={})).RefreshToc="refresh-toc"},35987:function(e,t,n){var r,i;n.d(t,{b:function(){return r}}),(i=r||(r={})).Click="click",i.Interaction="interaction",i.Impression="impression"},89058:function(e,t,n){n.d(t,{Qg:function(){return i},Pk:function(){return c},pQ:function(){return o},Jj:function(){return a}});var r=n(13830);class i extends Event{constructor(e){super(r.i.Publish),this.data=e}}i.type=r.i.Publish,n(39338);class c extends Event{constructor(){super(r.i.SocketConnected)}}c.type=r.i.SocketConnected;class o extends Event{constructor(){super(r.i.SocketDisconnected)}}o.type=r.i.SocketDisconnected;class a extends Event{constructor(e){super(r.i.EditDataUpdate),this.data=e}}a.type=r.i.EditDataUpdate},39338:function(e,t,n){n.d(t,{K:function(){return i}});var r=n(13830);class i extends Event{constructor(){super(r.i.Refetch)}}i.type=r.i.Refetch},57317:function(e,t,n){n.d(t,{f:function(){return a}});var r=n(63488);let i=e=>(document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}),c=()=>"visible"===document.visibilityState,o=()=>!0,a=()=>(0,r.useSyncExternalStore)(i,c,o)},33913:function(e,t,n){n.r(t),n.d(t,{CurrentNoteDataAtomProvider:function(){return u},CurrentNoteDataProvider:function(){return s},SyncNoteDataAfterLoggedIn:function(){return v},getCurrentNoteData:function(){return l},setCurrentNoteData:function(){return d},useCurrentNoteDataSelector:function(){return E},useSetCurrentNoteData:function(){return h}});var r=n(98823),i=n(91267),c=n(63488),o=n(97270),a=n(52160);let{ModelDataProvider:s,ModelDataAtomProvider:u,getGlobalModelData:l,setGlobalModelData:d,useModelDataSelector:E,useSetModelData:h}=(0,i.createModelDataProvider)(),v=()=>{let e=E(e=>null==e?void 0:e.data.nid),t=(0,o.useSearchParams)().get("password"),{data:n}=(0,r.useQuery)({...a.o.note.byNid((null==e?void 0:e.toString())||"",t),enabled:!!e});return(0,c.useEffect)(()=>{n&&d(e=>{e.data=n.data})},[n]),null}},96670:function(e,t,n){n.r(t),n.d(t,{CurrentPageDataAtomProvider:function(){return u},CurrentPageDataProvider:function(){return c},getCurrentPageData:function(){return o},setCurrentPageData:function(){return a},useCurrentPageDataSelector:function(){return s}});var r=n(91267),i=n(76877);let{ModelDataProvider:c,getGlobalModelData:o,setGlobalModelData:a,useModelDataSelector:s,ModelDataAtomProvider:u}=(0,r.createModelDataProvider)();i.r8&&i.S_&&(window.getCurrentPageData=o)},1461:function(e,t,n){n.r(t),n.d(t,{CurrentPostDataAtomProvider:function(){return o},CurrentPostDataProvider:function(){return c},getGlobalCurrentPostData:function(){return a},setGlobalCurrentPostData:function(){return s},useCurrentPostDataSelector:function(){return u}});var r=n(91267),i=n(76877);let{ModelDataProvider:c,ModelDataAtomProvider:o,getGlobalModelData:a,setGlobalModelData:s,useModelDataSelector:u}=(0,r.createModelDataProvider)();i.r8&&i.S_&&(window.getModelPostData=a)},82633:function(e,t,n){n.r(t),n.d(t,{DashboardAppProviders:function(){return z},WebAppProviders:function(){return V}});var r=n(71590),i=n(83404),c=n(96052),o=n(79907),a=n(12887),s=n(96859),u=n(44598),l=n(42769),d=n(98823),E=n(97270),h=n(70494),v=n(29494),C=n(58168),f=n(65068),m=n(63488);let T=e=>{let{children:t}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(m.Suspense,{children:(0,r.jsx)("div",{"data-hide-print":!0,children:(0,r.jsx)(f.t,{buttonPosition:"bottom-left"})})}),t]})};var g=n(8585),P=n(5811),p=n(8057),A=n(191),x=n(86990);let D=e=>{let{children:t}=e;return(0,g.L)(()=>{let e=(0,A.P2)(()=>{let{innerWidth:e,innerHeight:t}=window;x.e.set(p.q,{sm:e>=640,md:e>=768,lg:e>=1024,xl:e>=1280,"2xl":e>=1536,h:t,w:e})},16);return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),(0,m.useEffect)(()=>{let e=e=>{(0,P.l)(!e.matches)};e(window.matchMedia("screen"));let t=t=>{e(t)};try{window.matchMedia("screen").addEventListener("change",t)}catch(e){}return()=>{window.matchMedia("screen").removeEventListener("change",t)}},[]),(0,r.jsx)(r.Fragment,{children:t})};var w=n(36183),_=n(98731),j=n(81641),S=n(13205);let N=()=>{let e=(0,S.useAppConfigSelector)(e=>{var t;return null===(t=e.custom)||void 0===t?void 0:t.scripts});return e?(0,r.jsx)(r.Fragment,{children:e.map(e=>{let t={...e};for(let n of Object.keys(e).filter(e=>/data[A-Z]/.test(e)))t[n.replace(/([A-Z])/g,"-$1").toLowerCase()]=t[n],delete t[n];return(0,r.jsx)(j.default,{...t},e.src)})}):null};var k=n(14873),y=n(62719),b=n(57317),R=n(13373),O=n(61110),L=n(43468);let I=()=>(0,R.O)()?(0,r.jsx)(G,{}):null,G=()=>{let e=(0,m.useRef)(!1),t=(0,E.useRouter)();(0,m.useEffect)(()=>{e.current||Promise.resolve().then(n.bind(n,61110)).then(n=>{let{socketClient:r}=n;e.current=!0,r.setRouter(t),r.initIO()})},[]);let r=(0,y.Yu)(),i=(0,m.useRef)(r),c=(0,y.Qb)();(0,m.useEffect)(()=>{let e=i.current;i.current=r,c&&(O.socketClient.emit(L.m.UpdateSid,{sessionId:r}),(0,k.bv)(e))},[c,r]);let o=(0,b.f)();return(0,m.useEffect)(()=>{o&&!c&&O.socketClient.reconnect()},[o,c]),null},M=[(0,r.jsx)(a.f,{},"themeProvider"),(0,r.jsx)(e=>{let{children:t}=e;return(0,r.jsx)(w.Provider,{store:x.e,children:t})},{},"jotaiStoreProvider"),(0,r.jsx)(c.Provider,{},"balancerProvider"),(0,r.jsx)(o.X,{features:()=>Promise.all([n.e(633),n.e(4594),n.e(4502),n.e(1515)]).then(n.bind(n,71515)).then(e=>e.default),strict:!0},"framer")],U=M.concat((0,r.jsx)(i.ReactQueryProvider,{},"reactQueryProvider"));function V(e){let{children:t}=e;return(0,r.jsxs)(l.F,{contexts:U,children:[t,(0,r.jsx)(I,{}),(0,r.jsx)(s.Y5,{},"modalStackProvider"),(0,r.jsx)(D,{},"viewportProvider"),(0,r.jsx)(_.D3,{},"PageScrollInfoProvider"),(0,r.jsx)(T,{},"debugProvider"),(0,r.jsx)(N,{})]})}let Y=M.concat((0,r.jsx)(i.ReactQueryProviderForDashboard,{},"reactQueryProvider"),(0,r.jsx)(e=>{let{children:t}=e,{data:n,isLoading:i}=(0,d.useQuery)({queryKey:["check-auth"],refetchInterval:3e5,queryFn:async()=>{let{ok:e}=await v.x1.proxy("master")("check_logged").get();return!!e}}),c=(0,E.useRouter)();return i?(0,r.jsx)(h.S,{}):(n||(C.A.error("Not auth!"),c.push("/")),t)},{},"auth"),(0,r.jsx)(u.y.Provider,{}));function z(e){let{children:t}=e;return(0,r.jsxs)(l.F,{contexts:Y,children:[t,(0,r.jsx)(s.Y5,{},"modalStackProvider"),(0,r.jsx)(D,{},"viewportProvider")]})}},61110:function(e,t,n){n.r(t),n.d(t,{socketClient:function(){return N}});var r=n(49315),i=n(96491),c=n(62719),o=n(54592),a=n(28523),s=n(89058),u=n(76877),l=n(83404),d=n(63488),E=n(55322),h=n(98659),v=n(22003),C=n(14873),f=n(75832),m=n(25112),T=n(35987),g=n(10826),P=n(58168),p=n(33913),A=n(96670),x=n(1461),D=n(52160),w=n(43468);let _=()=>{document.dispatchEvent(new CustomEvent("impression",{detail:{action:T.b.Impression,label:"Socket Realtime Event"}}))},j=(e,t,n)=>{var r,i,c,o,a;switch(e){case w.G.VISITOR_ONLINE:case w.G.VISITOR_OFFLINE:{let{online:e}=t;(0,v.PG)(e);break}case w.G.POST_UPDATE:{let e=(0,x.getGlobalCurrentPostData)();if(!e||e.id!==t.id)break;(0,x.setGlobalCurrentPostData)(e=>{let n={...t};Reflect.deleteProperty(n,"category"),Object.assign(e,n)}),(0,P.A)("文章已更新"),_(),e.text!==t.text&&document.dispatchEvent(new CustomEvent(m.y.RefreshToc));break}case w.G.POST_DELETE:location.pathname===(0,g.n)(g.Z.Post,{category:t.category.slug,slug:t.slug})&&(null===(r=(0,x.getGlobalCurrentPostData)())||void 0===r?void 0:r.id)===t.id&&(n.replace((0,g.n)(g.Z.PageDeletd,{})),P.A.error("文章已删除"),_());break;case w.G.NOTE_UPDATE:{let e=null===(i=(0,p.getCurrentNoteData)())||void 0===i?void 0:i.data;if(!e||e.id!==t.id)break;(0,p.setCurrentNoteData)(e=>{Object.assign(e.data,t)}),(0,P.A)("手记已更新"),_(),e.text!==t.text&&document.dispatchEvent(new CustomEvent(m.y.RefreshToc));break}case w.G.NOTE_DELETE:location.pathname===(0,g.n)(g.Z.Note,{id:t.id})&&(null===(c=(0,p.getCurrentNoteData)())||void 0===c?void 0:c.data.id)===t.id&&(n.replace((0,g.n)(g.Z.PageDeletd,{})),P.A.error("手记已删除"),_());break;case w.G.PAGE_UPDATED:case w.G.PAGE_UPDATE:{let{slug:e}=t;(null===(o=(0,A.getCurrentPageData)())||void 0===o?void 0:o.slug)===e&&((0,A.setCurrentPageData)(e=>{Object.assign(e,t)}),(0,P.A)("页面已更新"),_());break}case w.G.NOTE_CREATE:{let{title:e,nid:n}=t;P.A.success("有新的内容发布了："+"「".concat(e,"」"),{onClick:()=>{window.peek("/notes/".concat(n))},iconElement:d.createElement(f.ol),autoClose:!1}),_();break}case w.G.POST_CREATE:{let{title:e,category:n,slug:r}=t;P.A.success("有新的内容发布了："+"「".concat(e,"」"),{onClick:()=>{window.peek("/posts/".concat(n.slug,"/").concat(r))},iconElement:d.createElement(f.$F)}),_();break}case w.G.RECENTLY_CREATE:_(),location.pathname===(0,g.n)(g.Z.Thinking,{})||P.A.success("写下一点小思考：\n".concat(t.content),{autoClose:1e4,iconElement:d.createElement(f.iz),onClick:()=>{n.push((0,g.n)(g.Z.Thinking,{}))}});break;case w.G.SAY_CREATE:location.pathname===(0,g.n)(g.Z.Says,{})&&(_(),l.queryClient.setQueryData(h.i,e=>(0,E.Uy)(e,e=>{var n;null==e||null===(n=e.pages)||void 0===n||n[0].data.unshift(t)})));break;case w.G.ACTIVITY_UPDATE_PRESENCE:{let e=D.o.activity.presence(t.roomName).queryKey,n=l.queryClient.getQueryState(e);l.queryClient.cancelQueries({queryKey:e}),(0,C.ju)(t),(null==n?void 0:n.data)||l.queryClient.invalidateQueries({queryKey:e});break}case w.G.ACTIVITY_LEAVE_PRESENCE:l.queryClient.cancelQueries({queryKey:D.o.activity.presence(t.roomName).queryKey}),(0,C.bv)(t.identity);break;case w.G.ARTICLE_READ_COUNT_UPDATE:{let{id:e,count:n,type:r}=t;if(!n)break;switch(r){case"post":{let t=(0,x.getGlobalCurrentPostData)();(null==t?void 0:t.id)===e&&(0,x.setGlobalCurrentPostData)(e=>{e.count.read=n});break}case"note":{let t=null===(a=(0,p.getCurrentNoteData)())||void 0===a?void 0:a.data;(null==t?void 0:t.id)===e&&(0,p.setCurrentNoteData)(e=>{e.data.count.read=n})}}break}case"fn#media-update":(0,C.Px)(t);break;case"fn#ps-update":{let e=t.processInfo;(0,C.MD)(e);break}case"shiro#update":P.A.info("站点版本已更新，请刷新页面",{onClick:()=>{location.reload()}});break;default:window.dispatchEvent(new CustomEvent("event:".concat(e),{detail:t})),u.r8&&console.log(e,t)}};class S{setRouter(e){this.router=e}initIO(){this.socket&&(this.socket.on("connect",()=>{window.dispatchEvent(new s.Pk),(0,o.lG)(!0),this.waitingEmitQueue.forEach(e=>{e(this.socket)}),this.waitingEmitQueue=[]}),this.socket.on("disconnect",()=>{window.dispatchEvent(new s.pQ),(0,o.lG)(!1)}),this.socket.close(),this.socket.open(),(0,o.lG)(this.socket.connected),this.socket.on("message",e=>{if("string"!=typeof e)return this.handleEvent(e.type,(0,i.Yf)(e.data));let{data:t,type:n}=JSON.parse(e);this.handleEvent(n,(0,i.Yf)(t))}))}reconnect(){this.socket.open()}handleEvent(e,t){u.r8&&console.log(t),window.dispatchEvent(new CustomEvent(e,{detail:t})),j(e,t,this.router)}emit(e,t){let n=(n,r)=>{n.emit("message",{type:e,payload:t},e=>{r(e)})};return new Promise(e=>{this.socket&&this.socket.connected?n(this.socket,e):this.waitingEmitQueue.push(t=>{n(t,e)})})}constructor(){this.waitingEmitQueue=[];let e=a.j.replace(/\/$/,"");this.socket=(0,r.io)("".concat(e,"/web"),{timeout:1e4,reconnectionDelay:3e3,autoConnect:!1,reconnectionAttempts:3,transports:["websocket"],query:{socket_session_id:(0,c.Wt)()}})}}S.shared=new S;let N=S.shared},43468:function(e,t,n){var r,i,c,o;n.d(t,{G:function(){return r},m:function(){return i}}),(c=r||(r={})).GATEWAY_CONNECT="GATEWAY_CONNECT",c.GATEWAY_DISCONNECT="GATEWAY_DISCONNECT",c.VISITOR_ONLINE="VISITOR_ONLINE",c.VISITOR_OFFLINE="VISITOR_OFFLINE",c.AUTH_FAILED="AUTH_FAILED",c.COMMENT_CREATE="COMMENT_CREATE",c.POST_CREATE="POST_CREATE",c.POST_UPDATE="POST_UPDATE",c.POST_DELETE="POST_DELETE",c.NOTE_CREATE="NOTE_CREATE",c.NOTE_UPDATE="NOTE_UPDATE",c.NOTE_DELETE="NOTE_DELETE",c.PAGE_UPDATED="PAGE_UPDATED",c.PAGE_UPDATE="PAGE_UPDATE",c.SAY_CREATE="SAY_CREATE",c.SAY_DELETE="SAY_DELETE",c.SAY_UPDATE="SAY_UPDATE",c.RECENTLY_CREATE="RECENTLY_CREATE",c.RECENTLY_DELETE="RECENTLY_DELETE",c.ACTIVITY_UPDATE_PRESENCE="ACTIVITY_UPDATE_PRESENCE",c.ACTIVITY_LEAVE_PRESENCE="ACTIVITY_LEAVE_PRESENCE",c.ARTICLE_READ_COUNT_UPDATE="ARTICLE_READ_COUNT_UPDATE",(o=i||(i={})).Join="join",o.Leave="leave",o.UpdateSid="updateSid"}}]);